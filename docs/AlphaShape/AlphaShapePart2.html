<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="G.W. Lucas">
    <title>Implementation details for a 2D alpha shape utility</title>

    <link rel="stylesheet" href="../css/960_12_col.css" />
    <link rel="stylesheet" href="../css/text.css" />
    <link rel="stylesheet" href="../css/layout.css" />
</head>


<body>
    <div class="container_12">
        <div >
            <a class="top-link" href = "https://gwlucastrig.github.io/TinfourDocs/">Home</a>
            |
            <a class="top-link"  href="https://github.com/gwlucastrig/Tinfour">Code Repository (Github)</a>
            |
            <a class="top-link"  href="https://github.com/gwlucastrig/Tinfour/wiki">Wiki</a>
            |
            <a class="top-link"  href="AlphaShapePart1.html">Part 1: Concepts</a>
        </div>

        <div id="notescontent">

            <div class="titleblock">
                <p class="title">
                    Implementation details for a 2D alpha shape utility<br>Part 2: Implementation
                </p>
                <p class="author">by G.W. Lucas</p>
            </div>

            <div class="grid_10">
                <p>
                    <b>Note:</b> This webpage is under construction. <strong>More content coming soon.</strong>
                </p>

                <h1>Introduction</h1>
                <p>Part 1 of these notes introduced the concepts underlying a 2D alpha shape utility.
                    This section of the notes covers technical details and the methods implemented by the utility.
                    Although the Tinfour AlphaShape class is written in Java, the ideas described
                    in these notes would carry over to any development environment.</p>

                <p>The classic alpha shape definition depends on the construction of a
                    <a href="https://gwlucastrig.github.io/TinfourDocs/DelaunayIntro/index.html">Delaunay triangulation</a>.
                    And, naturally, the Tinfour AlphaShape code is built on top
                    of the Tinfour Delaunay triangulation classes. Tinfour implements the Delaunay
                    using a Java interface known as IIncrementalTin (for "incremental triangulated irregular network").
                    While some of the operations described in this article depend the capabilities
                    defined by that interface, all of the functions it uses should have equivalents
                    in other Delaunay triangulation implementations.</p>

                <h1 id="IsAnEdgeExposed">Is an edge exposed?</h1>
                <p>As discussed in Part 1 of these notes, the alpha shape definition treats
                    each edge in the Delaunay triangulation as either
                    exposed or not exposed depending on whether any of the neighboring points in the sample
                    set lie within the pair of circles of radius <i>r</i> associated with the edge
                    (see <a href="./AlphaShapePart1.html#TheCircleSelectionCriterion">The circle selection criteria</a>).</p>

                <p>If we had to search for every point in an input sample set in order to discover whether
                    a circle is occupied or note, the processing cost for a large set of points
                    might become prohibitive (on the order of N<sup>2</sup>).
                    Fortunately, the nature of the Delaunay triangulation makes that
                    unnecessary.
                </p>
                <p>To determine the alpha exposure value
                    for any standard edge in the Delaunay triangulation, it is sufficient
                    to inspect the two vertices opposite that edge. If an alpha circle
                    is not occupied by either of the associated vertices, then it will not
                    be occupied by any other vertices in the Delaunay triangulation.
                </p>
                <p><strong>More content to come:</strong> images and discussion. Show the layout
                    of the two triangles near a Delaunay edge. Explain how to classify borders.
                    Note that a proof is required for this claim.</p>

                <h1 id="BuildingTheAlphaShape">Building the alpha shape</h1>
                <p><strong>More content to come:</strong> images and discussion.
                    Explain the edge traversal logic for creating polygons.
                    Explain isolated vertices issue.</p>

                <h1 id="AlphaCircleCalculation">The alpha circle calculation</h1>
                <p>The key calculation in the alpha shape technique is to find the centers
                    for two circles of radius <i>r</i> that intersect a line segment of length
                    <i>2r</i> or less. This calculation can be accomplished using basic algebra,
                    though a software implementation needs to make a few adjustments to compensate
                    for the limits of float-point arithmetic.  In particular, when processing
                    geospatial data, we are often faced with coordinates that are separated by small
                    distances but have a large magnitude. And, under some circumstances, calculations
                    with large-magnitude values suffer a loss of precision when low-order digits
                    drop out of addition or subtraction operations. So the calculation
                    below uses a simple offsetting transformation to reduce the magnitude
                    of the values the software needs to process in a numerical calculation.</p>
                <p>Given a line segment
                    <img class="imageInText" width=35 height=25 src="math2/image001.png">
                    with distinct endpoints
                    <img class="imageInText" width=123 height=29 src="math2/image002.png">
                    and <img class="imageInText" width=126 height=29 src="math2/image003.png">,
                    we wish to find the coordinates for the centers of two alpha circles
                    <img class="imageInText" width=124 height=29 src="math2/image004.png">
                    and
                    <img class="imageInText" width=119 height=29 src="math2/image005.png">.
                </p>
                <p>Let</p>
                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image006.png"></td>
                    </tr>
                </table>
                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image007.png"></td>
                    </tr>
                </table>

                <p>This specification essentially transforms the problem into finding the centers
                    of two circles of radius r that intersect the points
                    <img class="imageInText" src="math2/image008.png">
                    and  <img class="imageInText" src="math2/image009.png">.
                    Once we find those centers, we can transform them back to the original
                    coordinate system by adding back the offset for
                    <img class="imageInText" src="math2/image009a.png">.

                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image010.png"></td>
                        <td class="math2">[1]</td>
                    </tr>
                </table>

                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image011.png"></td>
                    </tr>
                </table>


                <p>Solving the two simultaneous equations in [1] for y as a function of x, we have</p>

                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image012.png"></td>
                        <td class="math2">[2]</td>
                    </tr>
                </table>

                <p>assuming that <i>k</i> is not zero.</p>

                <p>Let</p>
                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image013.png"></td>
                        <td class="math2">[3]</td>
                    </tr>
                </table>
                <p>with</p>
                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image014.png"></td>
                    </tr>
                </table>

                <p>Substituting [3] into [1], we have</p>
                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image015.png"></td>
                    </tr>
                </table>

                <p>and</p>
                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image016.png"></td>
                        <td class="math2">[4]</td>
                    </tr>
                </table>
                <p>Solving the quadratic equation [4] gives us two values for x
                    corresponding to the centers of the two circles:</p>
                <table class="math">
                    <tr>
                        <td class="math1"><img width="251" height="60" src="math2/image018.png"></td>
                    </tr>
                </table>
                <p>Designating the values of <i>x</i> as <i>x<sub>0</sub></i> and <i>x<sub>1</sub></i>,
                    compute  <i>y<sub>0</sub></i> and <i>y<sub>1</sub></i> using [2].
                    Then for each coordinate pair, we have circle centers
                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image019.png"></td>
                    </tr>
                </table>
                <p>Special cases exist when the line segment is of length <i>2r</i>
                    (the quadratic has a single solution), length greater than <i>2r</i>
                    (the quadratic has no solution), and the line segment is of zero length
                    (the two endpoints are not distinct and an alternate, trivial solution applies).</p>
                <p>In the equations above, we assume that the value for <i>k</i>
                    is not zero and allow it to appear in the denominator for some of the equations.
                    If <i>k</i> is zero, then the y coordinates of the line segment
                    <img class="imageInText" width="35" height="25" src="math2/image001.png">
                    would be equal and there is a simpler calculation that we could
                    use for the circle centers.  But doing so would not address the floating-point
                    arithmetic issues that would arise when <i>k</i> was non-zero but had a very
                    small absolute value.  To avoid putting near-zero values in the denominator,
                    Tinfour uses an alternate derivation of the calculation for circle centers.
                    When <img class="imageInText" width="72" height="25" src="math2/image020.png">
                    it puts <i>h</i> in the denominator rather than
                    <i>k</i> by solving the simultaneous equations in [1] to get
                    <i>x</i> as a function of <i>y</i>.
                </p>

                <table class="math">
                    <tr>
                        <td class="math1"><img src="math2/image021.png"></td>
                        <td class="math2">[5]</td>
                    </tr>
                </table>
                <p>
                    This expression closely resembles expression [2] which gave
                    us <i>y</i> as a function of <i>x</i>.
                    The rest of the alpha-circle calculation follows in a manner similar
                    to the steps above: solve the quadratic equation for <i>y</i>
                    and compute the two values
                    <i>x<sub>0</sub></i> and <i>x<sub>1</sub></i>
                    from
                    <i>y<sub>0</sub></i> and <i>y<sub>1</sub></i>.</p>
                <p>In Tinfour's AlphaCircle class, there are two blocks of code
                    for computing the circle centers. One puts <i>h</i> in
                    the denominator, and one that puts <i>k</i> in the denominator,
                    depending on which of the variables has the largest absolute value.
                    While there is some redundancy in the code,
                    this approach neatly avoid numeric problems
                    when either <i>h</i> or <i>k</i> are nearly zero.</p>

            </div>
        </div>
    </div>
</body>

