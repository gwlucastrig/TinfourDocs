<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="G.W. Lucas">
    <title>Implementation details for a 2D alpha shape utility</title>

    <link rel="stylesheet" href="../css/960_12_col.css" />
    <link rel="stylesheet" href="../css/text.css" />
    <link rel="stylesheet" href="../css/layout.css" />
</head>


<body>
    <div class="container_12">
        <div >
            <a class="top-link" href = "https://gwlucastrig.github.io/TinfourDocs/">Home</a>
            |
            <a class="top-link"  href="https://github.com/gwlucastrig/Tinfour">Code Repository (Github)</a>
            |
            <a class="top-link"  href="https://github.com/gwlucastrig/Tinfour/wiki">Wiki</a>
            |
            <a class="top-link"  href="AlphaShapePart1.html">Part 1: Concepts</a>
            |
            <a class="top-link"  href="AlphaShapePart3.html">Part 3: Alpha circle calculation</a>
        </div>

        <div id="notescontent">

            <div class="titleblock">
                <p class="title">
                    Implementation details for a 2D alpha shape utility<br>Part 2: Implementation
                </p>
                <p class="author">by G.W. Lucas</p>
            </div>

            <div class="grid_10">
                <p>
                    <b>Note:</b> This webpage is under construction. Some of its content
                    is still evolving and may not be completely accurate.
                    <strong>More content and corrections are coming soon.</strong>
                </p>

                <h1>Introduction</h1>
                <p>Part 1 of these notes introduced the concepts underlying a 2D alpha shape utility.
                    This section of the notes covers the algorithms and technical details of the Tinfour
                    implementation. Although the Tinfour AlphaShape class is written in Java, the ideas described
                    in these notes would carry over to any development environment.</p>

                <p>The classic alpha shape definition depends on the construction of a
                    <a href="https://gwlucastrig.github.io/TinfourDocs/DelaunayIntro/index.html">Delaunay triangulation</a>.
                    And, naturally, the Tinfour AlphaShape code is built on top
                    of the Tinfour Delaunay triangulation classes. Tinfour implements the Delaunay
                    using a Java interface known as IIncrementalTin (for "incremental triangulated irregular network").
                    While some of the operations described in this article depend the capabilities
                    defined by that interface, all of the functions it uses should have equivalents
                    in other Delaunay triangulation implementations.</p>

                <h1 id="Preliminaries">Preliminaries</h1>
                <p>Before getting into the techniques used by AlphaShape, we will briefly review the
                    relevant features of Tinfour Delaunay triangulations. The figure below illustrates
                    the structure of a simple triangulation based on four vertices labeled A, B, C, and D.</p>


                <img width="320" height="335" alt="Triangulation A,B,C,D"
                     title="Delaunay triangulation for 4 points" src="images2/TinfourPreliminaries1.png"/>

                <p>The following details will be relevant to our discussion of the Tinfour algorithms
                    for constructing an AlphaShape from a Delaunay triangulation.</p>

                <ul>
                    <li>Tinfour Delaunay triangulations implement a collection of vertices and edges.
                        Triangles are not actively maintained in memory, but may be constructed on an as-needed basis.</li>
                    <li>In the classic Delaunay triangulation, pairs of vertices are linked together by bi-directional
                        edges.  Tinfour uses a "paired edge" structure in which two single-direction edges
                        are coupled together, one edge for each direction of traversal.</li>
                    <li>Each Tinfour edge carries a reference to a corresponding "dual" edge that supports
                        the opposite direction of traversal. In the figure above, the edge labeled "0"
                        indicates the traversal from vertex A to B. Its dual, the edge labeled "1"
                        supports the traversal from vertex B to A.</li>
                    <li>Tinfour assigns unique integer index values to each edge at the time
                        it is created. These index values allow an application to maintain
                        supplemental information about the edges they represent.</li>
                    <li>To form triangles, each Tinfour edge is linked to two other edges.
                        These linked edges are referred to the "forward" edge and the "reverse"
                        edge. The Tinfour API provides methods for obtaining references to each linked edge
                        (forward, reverse, and dual).</li>
                    <li>When three edges are linked together to form a triangle,
                        the triangle is always specified in counterclockwise order.</li>
                </ul>

                <p>Additional details about the Tinfour edge concept are presented in our Wiki article
                    <a href="https://github.com/gwlucastrig/Tinfour/wiki/Tutorial-Using-Edge-Based-Techniques-Part-1">
                        Tutorial Using Edge Based Techniques</a>.

                <h1 id="BuildingAnAlphaShape">Building an alpha shape</h1>
                <p>The Tinfour technique for building an alpha is a three-step process:</p>
                <ol>
                    <li>Create a Delaunay triangulation from a set of
                        scattered data points</li>
                    <li>Use the alpha-circle criteria to identify edges from
                        the triangulation as being either a border, or interior or exterior
                        to the alpha shape (Edelsbrunner referred to exterior edges as α-exposed).</li>
                    <li>Connect the border edges together to form polygons enclosing
                        the alpha shape.
                        <ul>
                            <li>An alpha shape may consist of multiple polygons.</li>
                            <li>Some polygons may include "holes" (nested polygons).</li>
                            <li>For sufficiently small radius values, it may be impossible
                                to build polygons that enclose all of the input points.
                                Some points may remain as "orphans" which must be treated
                                as isolated individuals rather than part of a polygon structure.</li>
                        </ul>
                    </li>
                </ol>

                <p>The Delaunay triangulation is the focus of the Tinfour software project.
                    Given a set of scattered points, the Tinfour API includes classes
                    that link points into a triangle-based mesh structure that
                    can be accessed through the Java interface IIncrementalTin.
                    Interested readers may consult our <a href="https://gwlucastrig.github.io/TinfourDocs/">project documentation</a>
                    and <a href="https://github.com/gwlucastrig/Tinfour/wiki">Wiki page</a> for
                    more information.</p>



                <h1 id="IsAnEdgeExposed">Is an edge exposed?</h1>
                <p>Once a Delaunay triangulation is constructed from a set of scattered points,
                    it may be passed to Tinfour's AlphaShape constructor
                    along with an arbitrarily specified radius value.</p>
                <p>AlphaShape begins by classifying each edge in the Delaunay triangulation
                    as either interior (α-unexposed), exterior (α-exposed), or a border according
                    to the following rules:</p>
                <ul>
                    <li>α-exposed: If both of the alpha circles associated with the
                        edge are empty, the edge is exterior to the alpha shape.</li>
                    <li>α-unexposed: If both of the circles are occupied by distinct vertices,
                        the edge is interior to the alpha shape.</li>
                    <li>border: If one of the circles is occupied by a vertex
                        and the other is empty, then the edge is a border
                        of the alpha shape
                        (see <a href="./AlphaShapePart1.html#TheCircleSelectionCriterion">The circle selection criteria</a>).
                    </li>
                    <li>border (Tinfour modified rule): If both circles are
                        occupied by the same vertex, but not by any others,
                        the edge is a border of the alpha shape
                        (see <a href="AlphaShapePart1.html#TinfourModifications">
                            Tinfour modifications for border identification</a>).
                    </li>
                </ul>


                <p>If we had to search for every point in an input sample set in order to discover whether
                    a circle is occupied or not, the processing cost for a large set of points
                    might become prohibitive (on the order of N<sup>2</sup>).
                    Fortunately, the nature of the Delaunay triangulation makes that
                    unnecessary.
                </p>
                <p>To determine the alpha exposure value
                    for any standard edge in the Delaunay triangulation, it is sufficient
                    to inspect the two vertices opposite that edge. If an alpha circle
                    is not occupied by either of the associated vertices, then it will not
                    be occupied by any other vertices in the Delaunay triangulation.
                    A typical edge/vertex situation is illustrated in the figure below</p>

                <img width="780" height="390" alt="Delaunay and Alpha Circles"
                     title="Relationship between Delaunay and alpha circles"
                     src="images2/TinfourPreliminaries2.png"/>

                <h2>Assigning an edge as a border or interior component</h2>
                <p>When both alpha circles associated with an segment (pair of edges)
                    are occupied by vertices, the segment is treated as being part
                    of the <i>interior</i> of the alpha shape. When both circles
                    are empty, the segment is treated as being <i>exterior</i>
                    to the alpha shape.
                    Because the alpha circles contain a vertex on one side of segment AB, but not both,
                    the segment would be treated as a border. The alpha circle to the
                    right of the edge is occupied by Vertex D.  The alpha circle
                    to the left is not occupied. Tinfour defines the side of the edge
                    with an empty circle as being <i>exterior</i> to the alpha shape.
                    The side of the edge with an occupied circle is treated as being
                    in the <i>interior</i>.
                </p>
                <p>During the construction of the
                    AlphaShape, Tinfour maintains an array of flags indicating which edges
                    are interior to the alpha shape and which are
                    borders<sup><a href="#Note1">[1]</a></sup>.
                    These arrays are named covered[] and border[]. The arrays are indexed
                    using the edge index as shown in the figure above<sup><a href="#Note2">[2]</a></sup>.
                    In the figure above, segment AB is a border because only
                    one of the alpha circles is occupied (by vertex D). The
                    segment has two sides (two Tinfour edge objects) which are
                    numbered 0 and 1.  In the figure, the edge to the left of
                    segment, which has edge index 0, faces the exterior of the alpha shape.
                    So border[0] would be set to true. The edge to the right of
                    the segment, which has edge index 1, faces the interior
                    of the alpha shape, so covered[0] would be set to true.
                </p>

                <h1 id="AlphaPolygons">Stitching edges together to form alpha polygons</h1>

                <p>The alpha circle criterion allows an application to identify
                    a set of edges that border an alpha shape. Once the
                    border segments are established, the AlphaShape
                    links them together into polygons using a sweep technique
                    as illustrated in the figure below. Before considering the figure,
                    we note the following:</p>
                <ul>
                    <li>The outward side of the edge is marked with the border flag.
                        For example, in the upper part of the image, edges 1, 15, and 21 are
                        borders.</li>
                    <li>The inward side of the edge is marked with the covered
                        flag and treated as being interior to the alpha shape.
                        For example, edges 0, 14, and 20 are covered.</li>
                    <li>The alpha shape polygon will consist of the inside
                        edges and be given in a counterclockwise order.</li>
                </ul>

                <img width="780" height="500" alt="Alpha shape with sweeps"
                     title="Alpha shape construction using counterclockwise sweeps"
                     src="images2/AlphaShapeWithOuterSweeps.png"/>

                <h2 id="TheBigSweep">The sweep</h2>
                <p>The sweep process begins with an
                    arbitrarily chosen border edge.
                    As described above, the border edge faces outward from the alpha shape.
                    The logic adds the dual of the border edge (the dual is the inner facing edge)
                    to the polygon. The process then searches the edges that are adjacent to the
                    border by sweeping in a counterclockwise order around its initial point
                    (in the figure, the sweeps are shown as loops ending with arrows). The polygon is considered
                    complete when the search reaches the starting polygon.</p>
                <p>The alpha shape may contain multiple polygons.  Once
                    a polygon is completed, the code searches for any additional
                    edges that have not yet been committed to a polygon. As they are
                    found, the sweep-and-build process continues as described above.
                    When no additional uncommitted edges are available, the
                    polygon-building portion of the alpha shape algorithm terminates.</p>
                <p>The final step in the process is to collect a list of any individual vertices
                    that were not part of the region enclosed by the polygons.
                    To do so, Tinfour simply checks for
                    any vertices that were not connected to an edge that
                    was classified as covered.</p>

                <h3 id="AccomplishingTheSweep">Accomplishing the sweep</h3>
                <p>
                To perform the sweep operation, the AlphaShape class uses the
                forward, dual, and reverse links for each edge. The figure
                below shows a locally concave section of the Delaunay triangulation near
                its upper corner.</p>
                <img width=520 height=320 alt="ConcaveSweep" src="images2/AlphaShapeSectionSweeps.png">
                <p>The selection of starting edge for the polygon building loop
                    is arbitrary. Any border edge will do.  For this example, we select
                    edge 21 as the starting edge of the polygon building loop.
                    Its dual, edge 20, is interior to the alpha shape and would be
                    marked as covered. The polygon building logic adds covered
                    edges to the alpha-shape polygon and uses the border edges
                    to navigate its perimeter. So once edge 20 is added to the polygon,
                    the polygon building logic sweeps counter clockwise.
                </p>
                <p>
                    In the figure, we labeled  the initial vertex of edge 21 the "Pivot".
                    The next edge in the border traversal is edge 15.  Recalling
                    that Tinfour gives triangles in counterclockwise order, we see
                    that edge 15 is the <i>reverse</i> of edge 21. So for this particular
                    layout (a locally concave section of the alpha shape), the transfer is
                    simply a matter of moving to the reverse, edge 15. The building logic would
                    add the dual of edge 15, edge 14, to the polygon and continue the sweep.
                </p>
                <p>
                    The figure below shows a section of a different Delaunay triangulation
                    and illustrates a case where the alpha shape would be
                    is locally convex.  In that case, the traversal is a little more complicated.
                    If the algorithm was positioned at edge 507
                    the sweep would have to traverse across 4 α-exposed edges in order
                    to reach the next border segment (edge 501). </p>

                <img width="780" height="536" alt="ConvexSection" src="images2/AlphaShapeSectionS2.png"/>

                <p>The observation that the traversal must sometimes cross multiple edges
                    leads to a more complete description of the traversal rule:</p>
                <ul>
                    <li>For the current edge, obtain its reverse link
                        <ul>
                            <li>If the reverse link is a border, transfer to the reverse.</li>
                            <li>If the reverse link is α-exposed,  transfer to the
                                dual of the the reverse link</li>
                        </ul>
                    </li>
                </ul>

                <p>Finally, we note that in the figures above, the sweeps sometimes
                    pass outside the convex hull of the Delaunay triangulation.
                    To ensure that the Delaunay triangulation link relationships
                    are fully populated (reverse, forward, and dual), Tinfour implements
                    a set of non-standard edges (so called "ghost edges") which
                    lie outside the convex hull. The presence os these edges
                    allows the AlphaShape class to apply the traversal rules
                    without special considerations.</p>

                <p><strong>More content to come:</strong> Present the complete
                    algorithm in outline form, suitable for implementation.
                    Add a conclusion.  Mention the example class
                    AlphaShapeDemoImage.java from the Tinfour code distribution.
                </p>

                <h1 id="Notes">Notes</h1>
                <p id="Note1">
                    [1] Edelsbrunner, et al., original paper treats border edges
                    as α-exposed. That choice reflects the mathematical
                    basis for their proofs and derivation (as does the choice of
                    open circles versus closed circles for the edge selection
                    criterion). To distinguish implementation considerations
                    the Tinfour code does not use the term "unexposed". Instead,
                    it uses the term "covered" to refer to edges that are
                    either α-unexposed (interior) or part of the border.
                </p>

                <p id="Note2">
                    [2] For clarity, it is worth noting that what Tinfour
                    calls an "edge" is usually just a single side of a
                    bidirectional segment created between two vertices
                    in the Delaunay triangulation.
                </p>


                <h1 id="References">References</h1>
                <p>Edelsbrunner, Herbert; Kirkpatrick, David G.; Seidel, Raimund. (1983).
                    On the shape of a set of points in the plane,
                    <i>IEEE Transactions on Information Theory</i>, 29 (4): 551–559, doi:10.1109/TIT.1983.1056714.
                </p>

            </div>
        </div>
    </div>
</body>

